#!/usr/bin/env bash

if ls --color > /dev/null 2>&1; then
	colorflag="--color"
	export LS_COLORS="di=1;36:ln=1;32:so=37:pi=1;31;40:ex=35:bd=37:cd=37:su=37:sg=37:tw=32:ow=32"
else
	colorflag="-G"
	export LSCOLORS="GxCxhxBafxhxhxhxhxcxcx"
fi

alias ls="ls ${colorflag}"
alias sudo="sudo "

if [[ $COLORTERM = gnome-* && $TERM = xterm ]] && infocmp gnome-256color >/dev/null 2>&1; then
	export TERM="gnome-256color";
elif infocmp xterm-256color >/dev/null 2>&1; then
	export TERM="xterm-256color";
fi;

prompt() {
	local s="";
	local branchName="";

	if [ $(git rev-parse --is-inside-work-tree &>/dev/null; echo "${?}") == "0" ]; then

		if [ "$(git rev-parse --is-inside-git-dir 2> /dev/null)" == "false" ]; then

			git update-index --really-refresh -q &>/dev/null;

			if ! $(git diff --quiet --ignore-submodules --cached); then
				s+="+";
			fi;

			if ! $(git diff-files --quiet --ignore-submodules --); then
				s+="!";
			fi;

			if [ -n "$(git ls-files --others --exclude-standard)" ]; then
				s+="?";
			fi;

			if $(git rev-parse --verify refs/stash &>/dev/null); then
				s+="$";
			fi;

		fi;

		branchName="$(git symbolic-ref --quiet --short HEAD 2> /dev/null || \
			git rev-parse --short HEAD 2> /dev/null || \
			echo "(unknown)")";

		[ -n "${s}" ] && s=" [${s}]";

		echo "${1}${branchName}${2}${s}";
	else
		return;
	fi;
}

tput sgr0;
reset=$(tput sgr0);
blue=$(tput setaf 32);
green=$(tput setaf 34);
orange=$(tput setaf 208);
red=$(tput setaf 197);
violet=$(tput setaf 97);
white=$(tput setaf 255);

if [[ "${USER}" == "root" ]]; then
	userStyle="${red}";
else
	userStyle="${violet}";
fi;

PS1="\[\033[1;37m\]";
PS1+="\n";
PS1+="\[${userStyle}\]\u ";
PS1+="\[${green}\]\w";
PS1+="\$(prompt \" \[${blue}\]\" \"\[${orange}\]\")";
PS1+="\[${white}\]\n";

if [[ "${USER}" == "root" ]]; then
	PS1+="# \[${reset}\]";
else
	PS1+="$ \[${reset}\]";
fi;
